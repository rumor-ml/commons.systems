{
  "name": "Fellspiral Monorepo (Nix + Node)",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:1-20-bookworm",

  // Install Nix and configure it with flakes support
  "features": {
    "ghcr.io/devcontainers/features/nix:1": {
      "version": "latest",
      "multiUser": false,
      "extraNixConfig": "experimental-features = nix-command flakes\nextra-substituters = https://cache.nixos.org https://nix-community.cachix.org\nextra-trusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY= nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=\ntrusted-substituters = https://cache.nixos.org https://nix-community.cachix.org\ntrusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY= nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=\ndownload-buffer-size = 134217728"
    }
  },

  // Install npm dependencies (Nix tools available via 'nix develop')
  "postCreateCommand": "npm install",

  // Show welcome message with instructions
  "postStartCommand": "echo 'ðŸš€ Dev environment ready! Use \"nix develop\" to access gcloud, gh, terraform, etc.'",

  // Forward ports for development
  "forwardPorts": [3000],

  // VS Code customizations
  "customizations": {
    "vscode": {
      "extensions": [
        "jnoortheen.nix-ide"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "nix-shell",
        "terminal.integrated.profiles.linux": {
          "bash": {
            "path": "/bin/bash"
          },
          "nix-shell": {
            "path": "/bin/bash",
            "args": ["-c", "nix develop --accept-flake-config --command bash"]
          }
        },
        "nix.enableLanguageServer": false
      }
    }
  },

  // Environment variables
  "containerEnv": {
    "NIXPKGS_ALLOW_UNFREE": "1"
  }
}
