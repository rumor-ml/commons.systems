{
  "name": "Fellspiral Monorepo (Nix)",
  "image": "nixos/nix:latest",

  // Configure Nix with flakes support on container creation
  "onCreateCommand": {
    "configure-nix": "mkdir -p ~/.config/nix && echo 'experimental-features = nix-command flakes' > ~/.config/nix/nix.conf",
    "setup-env": "nix develop --command bash -c 'echo \"Nix environment configured with: gcloud, gh, terraform, node, npm\"'"
  },

  // Install npm dependencies after Nix environment is ready
  "postCreateCommand": "nix develop --command npm install",

  // Show welcome message on each start
  "postStartCommand": "echo 'ðŸš€ Fellspiral dev environment ready! All tools available via: nix develop'",

  // Forward ports for development
  "forwardPorts": [3000],
  "portsAttributes": {
    "3000": {
      "label": "Dev Server",
      "onAutoForward": "notify"
    }
  },

  // VS Code customizations
  "customizations": {
    "vscode": {
      "extensions": [
        "jnoortheen.nix-ide",
        "bbenoist.Nix"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.profiles.linux": {
          "bash": {
            "path": "/bin/bash",
            "args": ["-l"]
          },
          "nix-shell": {
            "path": "nix",
            "args": ["develop", "--command", "bash"]
          }
        },
        "nix.enableLanguageServer": false
      }
    }
  },

  // Environment variables
  "containerEnv": {
    "NIXPKGS_ALLOW_UNFREE": "1"
  },

  // Mount workspace folder
  "workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",

  // Run as root (required for Nix)
  "remoteUser": "root"
}
