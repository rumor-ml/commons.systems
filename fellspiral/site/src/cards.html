<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark light" />
    <title>Card Manager - Fellspiral</title>
    <meta name="description" content="Manage cards for Fellspiral tactical tabletop RPG" />
    <link rel="stylesheet" href="/styles/main.css" />
    <link rel="stylesheet" href="/styles/cards.css" />
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script type="module" src="/scripts/main.js"></script>
  </head>
  <body>
    <div class="layout">
      <!-- Sidebar Navigation -->
      <aside
        class="sidebar"
        id="sidebar"
        hx-boost="true"
        hx-target=".main-content"
        hx-select=".main-content"
        hx-swap="outerHTML scroll:none"
      >
        <div class="sidebar-header">
          <h1 class="site-title">Fellspiral</h1>
          <p class="site-tagline">Tactical Tabletop RPG</p>
        </div>

        <nav class="sidebar-nav">
          <!-- Navigation generated by sidebar-nav.js -->
        </nav>

        <div class="nav-auth"></div>
      </aside>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Main Content -->
      <main class="main-content card-manager">
        <div class="container-fluid">
          <div class="card-manager-layout">
            <!-- Main Content Area -->
            <div class="card-content">
              <!-- Toolbar -->
              <div class="card-toolbar">
                <div class="toolbar-actions">
                  <button id="addCardBtn" class="btn btn-primary auth-controls">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <path
                        d="M8 3a.5.5 0 01.5.5v4h4a.5.5 0 010 1h-4v4a.5.5 0 01-1 0v-4h-4a.5.5 0 010-1h4v-4A.5.5 0 018 3z"
                      />
                    </svg>
                    Add Card
                  </button>
                  <button id="importCardsBtn" class="btn btn-secondary auth-controls">
                    Import from Rules.md
                  </button>
                  <button id="exportCardsBtn" class="btn btn-secondary auth-controls">
                    Export JSON
                  </button>
                </div>
              </div>

              <!-- Card List/Grid View -->
              <div class="card-view-controls">
                <div class="view-mode">
                  <button class="view-mode-btn active" data-mode="grid">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <rect x="1" y="1" width="6" height="6" />
                      <rect x="9" y="1" width="6" height="6" />
                      <rect x="1" y="9" width="6" height="6" />
                      <rect x="9" y="9" width="6" height="6" />
                    </svg>
                  </button>
                  <button class="view-mode-btn" data-mode="list">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <rect x="1" y="2" width="14" height="2" />
                      <rect x="1" y="7" width="14" height="2" />
                      <rect x="1" y="12" width="14" height="2" />
                    </svg>
                  </button>
                </div>

                <div class="filter-controls">
                  <input
                    type="text"
                    id="searchCards"
                    placeholder="Search cards..."
                    class="search-input"
                  />
                </div>
              </div>

              <div id="cardList" class="card-grid">
                <div class="loading-state">
                  <div class="spinner"></div>
                  <p>Loading cards...</p>
                </div>
              </div>

              <!-- Empty State -->
              <div id="emptyState" class="empty-state" style="display: none">
                <svg
                  width="64"
                  height="64"
                  viewBox="0 0 16 16"
                  fill="currentColor"
                  class="empty-icon"
                >
                  <path d="M3 0h10a2 2 0 012 2v12a2 2 0 01-2 2H3a2 2 0 01-2-2V2a2 2 0 012-2z" />
                  <path fill="white" d="M5 4h6v1H5V4zm0 2h6v1H5V6zm0 2h4v1H5V8z" />
                </svg>
                <h3>No cards found</h3>
                <p>Get started by importing cards from rules.md or creating a new card</p>
                <button
                  class="btn btn-primary"
                  onclick="document.getElementById('importCardsBtn').click()"
                >
                  Import Cards
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Editor Modal - Inside main-content for HTMX navigation -->
        <div id="cardEditorModal" class="modal">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Add Card</h2>
          <button class="modal-close" id="closeModalBtn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="cardForm">
            <input type="hidden" id="cardId" />

            <div class="form-row">
              <div class="form-group">
                <label for="cardTitle">Title *</label>
                <input type="text" id="cardTitle" name="title" required class="form-control" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="cardType">Type *</label>
                <div class="combobox" id="typeCombobox">
                  <input
                    type="text"
                    id="cardType"
                    name="type"
                    required
                    class="form-control combobox-input"
                    placeholder="Type or select type..."
                    autocomplete="off"
                    role="combobox"
                    aria-expanded="false"
                    aria-controls="typeListbox"
                    aria-autocomplete="list"
                  />
                  <button
                    type="button"
                    class="combobox-toggle"
                    aria-label="Show options"
                    tabindex="-1"
                  >
                    <svg viewBox="0 0 16 16" fill="currentColor">
                      <path
                        d="M4.427 6.427a.75.75 0 011.06 0L8 8.94l2.513-2.513a.75.75 0 111.06 1.06l-3.043 3.044a.75.75 0 01-1.06 0L4.427 7.487a.75.75 0 010-1.06z"
                      />
                    </svg>
                  </button>
                  <ul id="typeListbox" class="combobox-listbox" role="listbox"></ul>
                </div>
              </div>

              <div class="form-group">
                <label for="cardSubtype">Subtype *</label>
                <div class="combobox" id="subtypeCombobox">
                  <input
                    type="text"
                    id="cardSubtype"
                    name="subtype"
                    required
                    class="form-control combobox-input"
                    placeholder="Type or select subtype..."
                    autocomplete="off"
                    role="combobox"
                    aria-expanded="false"
                    aria-controls="subtypeListbox"
                    aria-autocomplete="list"
                  />
                  <button
                    type="button"
                    class="combobox-toggle"
                    aria-label="Show options"
                    tabindex="-1"
                  >
                    <svg viewBox="0 0 16 16" fill="currentColor">
                      <path
                        d="M4.427 6.427a.75.75 0 011.06 0L8 8.94l2.513-2.513a.75.75 0 111.06 1.06l-3.043 3.044a.75.75 0 01-1.06 0L4.427 7.487a.75.75 0 010-1.06z"
                      />
                    </svg>
                  </button>
                  <ul id="subtypeListbox" class="combobox-listbox" role="listbox"></ul>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="cardTags">Tags (comma separated)</label>
              <input
                type="text"
                id="cardTags"
                name="tags"
                class="form-control"
                placeholder="2h, swept, precise"
              />
              <small class="form-help">Separate tags with commas</small>
            </div>

            <div class="form-group">
              <label for="cardDescription">Description</label>
              <textarea
                id="cardDescription"
                name="description"
                rows="3"
                class="form-control"
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="cardStat1">Stat 1</label>
                <input
                  type="text"
                  id="cardStat1"
                  name="stat1"
                  class="form-control"
                  placeholder="e.g., d8, 6 AC"
                />
              </div>

              <div class="form-group">
                <label for="cardStat2">Stat 2</label>
                <input
                  type="text"
                  id="cardStat2"
                  name="stat2"
                  class="form-control"
                  placeholder="e.g., 2 slot"
                />
              </div>

              <div class="form-group">
                <label for="cardCost">Cost</label>
                <input
                  type="text"
                  id="cardCost"
                  name="cost"
                  class="form-control"
                  placeholder="e.g., 5 pt"
                />
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancelModalBtn">Cancel</button>
          <button
            type="button"
            class="btn btn-danger auth-controls"
            id="deleteCardBtn"
            style="display: none"
          >
            Delete
          </button>
          <button
            type="submit"
            form="cardForm"
            class="btn btn-primary auth-controls"
            id="saveCardBtn"
          >
            Save Card
          </button>
        </div>
      </div>
    </div>
      </main>
    </div>

    <script type="module">
      import { initCardsPage } from '/scripts/cards.js';

      // Initialize cards page when directly loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => initCardsPage());
      } else {
        initCardsPage();
      }

      // Note: HTMX navigation re-initialization is handled by main.js
    </script>
  </body>
</html>
