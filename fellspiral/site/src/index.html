<!doctype html>
<html lang="en">
  <head>
    <!-- Firebase Hosting with auto-injected config -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark light" />
    <title>Fellspiral - Tactical Tabletop RPG</title>
    <meta
      name="description"
      content="A tactical tabletop RPG with initiative-based combat, zones, and strategic gameplay"
    />
    <!-- GitHub OAuth Authentication Enabled -->
    <link rel="stylesheet" href="/styles/main.css" />
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script type="module" src="/scripts/main.js"></script>
  </head>
  <body>
    <div class="layout">
      <!-- Sidebar Navigation -->
      <aside
        class="sidebar"
        id="sidebar"
        hx-boost="true"
        hx-target=".main-content"
        hx-select=".main-content"
        hx-swap="innerHTML"
      >
        <div class="sidebar-header">
          <h1 class="site-title">Fellspiral</h1>
          <p class="site-tagline">Tactical Tabletop RPG</p>
        </div>

        <nav class="sidebar-nav">
          <!-- Navigation generated by sidebar-nav.js -->
        </nav>

        <!-- Auth Components -->
        <div class="nav-auth"></div>
      </aside>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Main Content -->
      <main class="main-content">
        <section id="introduction" class="content-section">
          <h1>Fellspiral</h1>
          <p class="lead">
            A tactical tabletop RPG where initiative and narrative control shape the battlefield.
            Master the art of combat through strategic positioning, clever use of equipment, and
            creative storytelling.
          </p>
        </section>

        <section id="initiative" class="content-section">
          <h2>Initiative</h2>
          <p>
            <strong>Initiative</strong> is essential for controlling the tempo of battle. The player
            with initiative has narrative control of how an exchange plays out. This is especially
            important for determining the nature of the damage dealt.
          </p>
        </section>

        <section id="roles" class="content-section">
          <h2>Referee & Antagonist Roles</h2>
          <p>
            The <strong>referee</strong> and <strong>antagonist</strong> roles are distinct. The
            referee determines if narration is valid:
          </p>
          <ul>
            <li>Narration cannot contradict written rules</li>
            <li>Narration must match the setting</li>
            <li>Players cannot change the basic nature of characters they aren't playing</li>
          </ul>
        </section>

        <section id="damage" class="content-section">
          <h2>Damage System</h2>
          <p>
            <strong>Damage</strong> is dealt as "slots" and/or "conditions". Players have up to 10
            equipment slots and 10 skill slots. When AC fails to defend:
          </p>
          <ul>
            <li>Equipment or skill slots are lost</li>
            <li>Conditions are inflicted</li>
            <li>
              If no slots remain, take "shot to the heart" condition (removed from game at end of
              round)
            </li>
          </ul>
        </section>

        <section id="rounds" class="content-section">
          <h2>Combat Rounds</h2>
          <p>Combat rounds are divided into <strong>5 phases</strong>:</p>
          <ul>
            <li>Each player chooses a phase to act</li>
            <li>Each side rolls d20 - lowest chooses starting phase and acts first</li>
            <li>If two sides share a phase, the side with initiative acts first</li>
            <li>At round end, players with "shot to the heart" are removed</li>
          </ul>
        </section>

        <section id="zones" class="content-section">
          <h2>Zones</h2>
          <p>
            The battlefield is divided into zones (~10 paces each). Within a zone, targets can be
            adjacent or non-adjacent. By default, you cannot pass through foes.
          </p>
        </section>

        <section id="actions" class="content-section">
          <h2>Actions</h2>
          <h3>Free Actions (start of phase)</h3>
          <ul>
            <li>Move within zone</li>
            <li>Speak</li>
            <li>Use consumables</li>
          </ul>

          <h3>Choose One Action</h3>
          <ul>
            <li><strong>Move</strong> to next zone</li>
            <li><strong>Attack</strong> (defender rolls d20 + weapon die vs AC)</li>
            <li><strong>Equip</strong> gear from slots/environment</li>
            <li><strong>Use</strong> action skill/interact/cast spell</li>
            <li><strong>Hold</strong> - skip action, choose different phase</li>
            <li><strong>Hurry</strong> - move + action (or move twice) at -5 AC</li>
          </ul>
        </section>

        <section id="trading-initiative" class="content-section">
          <h2>Trading Initiative</h2>
          <ul>
            <li>Defender has initiative by default</li>
            <li>On strike + crit, attacker takes initiative</li>
            <li>Player with initiative narrates 1 slot loss OR replaces 1 slot with 1 condition</li>
            <li>If defender rolls 20, first equipment slot is destroyed permanently</li>
          </ul>
        </section>

        <section id="conditions" class="content-section">
          <h2>Conditions</h2>
          <dl class="condition-list">
            <dt>Pinned</dt>
            <dd>Attacker has initiative & +2 weapon rolls</dd>

            <dt>Stunned</dt>
            <dd>Cannot take action during phase</dd>

            <dt>Exhausted/Freezing</dt>
            <dd>Cannot hurry, use skills/spells. +5 AC when attacking</dd>

            <dt>Afraid</dt>
            <dd>Must use action to move away</dd>

            <dt>Immobilized</dt>
            <dd>Cannot use move action</dd>

            <dt>Bleeding/Corrosion/Burning</dt>
            <dd>Strike 1 slot at start of phase</dd>
          </dl>
        </section>

        <section id="weapons" class="content-section">
          <h2>Weapons</h2>
          <div class="equipment-grid">
            <div class="equipment-item">
              <h3>Long Sword</h3>
              <div class="tags">
                <span class="tag">2h</span>
                <span class="tag">-1c</span>
                <span class="tag">swept</span>
                <span class="tag">precise</span>
              </div>
              <p>d10 weapon die, 2 slots</p>
              <p class="note">Can use 1-handed (d8, no -1c) but cannot equip second weapon</p>
            </div>

            <div class="equipment-item">
              <h3>Long Bow</h3>
              <div class="tags">
                <span class="tag">1x</span>
                <span class="tag">1-4 ranged</span>
                <span class="tag">-1z2-3</span>
                <span class="tag">-2z4</span>
                <span class="tag">2h</span>
                <span class="tag">precise</span>
              </div>
              <p>d6 weapon die, 2 slots</p>
            </div>

            <div class="equipment-item">
              <h3>Dagger</h3>
              <div class="tags">
                <span class="tag">0-1 thrown</span>
                <span class="tag">precise</span>
              </div>
              <p>d4 weapon die, 2 slots</p>
            </div>

            <div class="equipment-item">
              <h3>Scimitar</h3>
              <div class="tags">
                <span class="tag">swept</span>
                <span class="tag">precise</span>
                <span class="tag">1 adjacent</span>
              </div>
              <p>d6 weapon die, 2 slots</p>
            </div>

            <div class="equipment-item">
              <h3>Spear</h3>
              <div class="tags">
                <span class="tag">0-1 thrown</span>
                <span class="tag">-4z1</span>
                <span class="tag">reach</span>
                <span class="tag">precise</span>
              </div>
              <p>d8 weapon die, 2 slots</p>
            </div>

            <div class="equipment-item">
              <h3>Musket</h3>
              <div class="tags">
                <span class="tag">2x</span>
                <span class="tag">1-4 ranged</span>
                <span class="tag">-2z2-3</span>
                <span class="tag">d8r</span>
                <span class="tag">noisy</span>
                <span class="tag">2h</span>
              </div>
              <p>d6 weapon die, 4 slots</p>
            </div>
          </div>
        </section>

        <section id="armor" class="content-section">
          <h2>Armor</h2>
          <div class="equipment-grid">
            <div class="equipment-item">
              <h3>Chain Mail</h3>
              <p>+3 AC</p>
              <p class="note">Noisy</p>
            </div>

            <div class="equipment-item">
              <h3>Scale Vest</h3>
              <div class="tags"><span class="tag">durable</span></div>
              <p>+3 AC</p>
              <p class="note">Rare, requires expert blacksmith</p>
            </div>

            <div class="equipment-item">
              <h3>Helm</h3>
              <p>+1 AC</p>
              <p class="note">Draws enemy attention</p>
            </div>

            <div class="equipment-item">
              <h3>Greaves</h3>
              <p>+1 AC</p>
              <p class="note">Protects against some immobilize attempts</p>
            </div>

            <div class="equipment-item">
              <h3>Cloak</h3>
              <p>+1 AC, +3 Stealth</p>
            </div>

            <div class="equipment-item">
              <h3>Wood Shield</h3>
              <div class="tags"><span class="tag">durable</span></div>
              <p>+1 AC</p>
            </div>
          </div>
        </section>

        <section id="skills" class="content-section">
          <h2>Skills</h2>

          <h3>Attack Skills</h3>
          <dl class="skill-list">
            <dt>Surgical</dt>
            <dd>
              If weapon is <em>precise</em> and defender adjacent: on success, +1 weapon die and +1
              to roll
            </dd>

            <dt>Dual Wielding</dt>
            <dd>
              If 2 weapons equipped: on success, resolve second attack with other weapon (no attack
              skills)
            </dd>

            <dt>Take Aim</dt>
            <dd>
              If ranged + <em>precise</em>: attack resolves in 1d6 phases. On success, +1 weapon die
              and +3
            </dd>

            <dt>Melee</dt>
            <dd>If weapon is <em>swept</em>: On strike and success, add "1 adjacent"</dd>
          </dl>

          <h3>Defense Skills</h3>
          <dl class="skill-list">
            <dt>Counter Strike</dt>
            <dd>
              If attacker adjacent: on successful defense and skill roll, take no damage and next
              attack has initiative
            </dd>

            <dt>Moving Target</dt>
            <dd>If no conditions: on success, subtract result from defense roll (min 0)</dd>

            <dt>Brace</dt>
            <dd>
              Skip next action. On success, subtract result from defense and defend with initiative
            </dd>
          </dl>

          <h3>Tenacity Skills</h3>
          <dl class="skill-list">
            <dt>Grit</dt>
            <dd>On success, 1 slot damage directed to this skill, maintain initiative</dd>

            <dt>Flesh Wound</dt>
            <dd>
              If you have initiative: on success, 1 slot damage to this skill, gain "meat shield"
              slot
            </dd>
          </dl>
        </section>

        <section id="upgrades" class="content-section">
          <h2>Weapon Upgrades</h2>
          <div class="equipment-grid">
            <div class="equipment-item">
              <h3>Master-Craft</h3>
              <p>On crit, inflict burn on primary defender</p>
            </div>

            <div class="equipment-item">
              <h3>Serrated</h3>
              <p>On crit, inflict bleed on primary defender</p>
            </div>

            <div class="equipment-item">
              <h3>Sword Breaker</h3>
              <p>On crit, inflict corrosion on primary defender</p>
            </div>

            <div class="equipment-item">
              <h3>Lucky</h3>
              <p>-1c (easier to crit)</p>
            </div>

            <div class="equipment-item">
              <h3>Balanced</h3>
              <p>+1 to weapon roll</p>
            </div>

            <div class="equipment-item">
              <h3>Deadly</h3>
              <p>On strike, deal 1 additional slot of damage</p>
            </div>

            <div class="equipment-item">
              <h3>Knuckle Guard</h3>
              <p>Foe with initiative cannot disarm you</p>
            </div>
          </div>
        </section>

        <section id="simulator" class="content-section">
          <h2>Combat Simulator</h2>
          <p>
            Simulate battles between different foes and origins from the Fellspiral universe. Watch
            how the tactical combat system plays out in real-time!
          </p>

          <div class="simulator-controls">
            <div class="combatant-select">
              <label for="combatant1">Combatant 1</label>
              <select id="combatant1" class="select-character">
                <option value="caleb">Caleb (Origin - Human)</option>
                <option value="skeleton">Skeleton (Foe - Undead)</option>
                <option value="skeletonCommander">Skeleton Commander (Foe - Undead)</option>
                <option value="ghoul">Ghoul (Foe - Vampire)</option>
                <option value="krovnayaStriga">Krovnaya Striga (Foe - Vampire)</option>
              </select>
            </div>

            <div class="vs-divider">VS</div>

            <div class="combatant-select">
              <label for="combatant2">Combatant 2</label>
              <select id="combatant2" class="select-character">
                <option value="skeleton">Skeleton (Foe - Undead)</option>
                <option value="caleb">Caleb (Origin - Human)</option>
                <option value="skeletonCommander">Skeleton Commander (Foe - Undead)</option>
                <option value="ghoul">Ghoul (Foe - Vampire)</option>
                <option value="krovnayaStriga">Krovnaya Striga (Foe - Vampire)</option>
              </select>
            </div>
          </div>

          <button id="simulateBtn" class="btn btn-primary btn-large">Simulate Combat</button>

          <div id="combatLog" class="combat-log" style="display: none">
            <h3>Combat Log</h3>
            <pre id="logContent"></pre>
          </div>
        </section>

        <section id="examples" class="content-section">
          <h2>Combat Example: The Hungry Goblin</h2>

          <div class="story-beat">
            <div class="narrative">
              <p>
                You are fresh from camp when ambushed by a hungry goblin. The goblin attacks with
                his rusty sword and strikes for 1 slot, but as defender you retain the initiative.
              </p>
            </div>
          </div>

          <div class="story-beat player-narration">
            <div class="speaker">Player (with initiative)</div>
            <div class="narrative">
              <p>
                "My father's ceremonial sword will have its day of vengeance, but today is not that
                day. It is safely tucked within my bedroll. I step back from the goblin attack just
                in time, but the ceremonial sword is inaccessible now that the pace of battle has
                quickened."
              </p>
            </div>
            <div class="mechanics">Lost: Ceremonial sword slot (not tactically important)</div>
          </div>

          <div class="story-beat">
            <div class="narrative">
              <p>
                You attack with your dagger and score a critical strike to gain initiative. With
                initiative, you may choose to inflict a condition instead of slot damage.
              </p>
            </div>
          </div>

          <div class="story-beat player-narration">
            <div class="speaker">Player (with initiative)</div>
            <div class="narrative">
              <p>
                "The goblin knows he is outmatched, but he is hungry and desperate. I slice with my
                dagger. It is only enough to graze his cheek, but it's enough to frighten the goblin
                and make him flee."
              </p>
            </div>
            <div class="mechanics">Inflicted: Afraid condition (must flee)</div>
          </div>

          <div class="story-beat">
            <div class="narrative">
              <p>
                You pull out your long bow and hurry to create distance. The goblin steels himself
                and charges back.
              </p>
            </div>
          </div>

          <div class="story-beat antagonist-narration">
            <div class="speaker">Antagonist</div>
            <div class="narrative">
              <p>
                "The arrow strikes flesh, but this only enrages the goblin as he charges back at the
                adventurer."
              </p>
            </div>
            <div class="mechanics">Goblin uses "Flesh Wound" skill</div>
          </div>

          <div class="story-beat">
            <div class="narrative">
              <p>
                The goblin hurries to close the gap. You hurry to maintain distance, but he catches
                you. With a critical melee strike, he takes initiative.
              </p>
            </div>
          </div>

          <div class="story-beat antagonist-narration">
            <div class="speaker">Antagonist (with initiative)</div>
            <div class="narrative">
              <p>"The goblin leaps onto the adventurer, grasping his lapel, pinning him."</p>
            </div>
            <div class="mechanics">Inflicted: Pinned condition</div>
          </div>

          <div class="story-beat">
            <div class="narrative">
              <p>
                Your long bow is useless against the adjacent foe. You retrieve your dagger, but the
                goblin has initiative as he thrashes while pinning you.
              </p>
            </div>
          </div>

          <div class="story-beat antagonist-narration">
            <div class="speaker">Antagonist (with initiative)</div>
            <div class="narrative">
              <p>
                "The adventurer stumbles backward under the rabid goblin. He trips and drops his
                dagger."
              </p>
            </div>
            <div class="mechanics">Lost: Dagger slot</div>
          </div>

          <div class="story-beat">
            <div class="narrative">
              <p>
                Fortunately, you always carry a backup. Your AC defends against his next strike.
              </p>
            </div>
          </div>

          <div class="story-beat player-narration">
            <div class="speaker">Player (with initiative)</div>
            <div class="narrative">
              <p>"The goblin tried to bite me but his teeth fail to sink through my bracers."</p>
            </div>
            <div class="mechanics">Lost: Bracers (AC reduced)</div>
          </div>

          <div class="story-beat">
            <div class="narrative">
              <p>
                Now, backup dagger in hand, goblin at your throat, you strike true once more. How do
                you finish him?
              </p>
            </div>
          </div>
        </section>
      </main>
    </div>
  </body>
</html>
